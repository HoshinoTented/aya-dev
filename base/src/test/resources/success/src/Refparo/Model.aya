open import Paths

public open data Unit | unit

def coe {a b : Type} (eq : a = b) (x : a) : b
  => arcoe eq.at x right

-- *** Types

public open struct EventT : Type 1
  | AgentT : Type => Unit

def getAgentT (T : EventT) => T.AgentT
def setAgentT (A : Type) (T : EventT) : EventT
  => new EventT { | AgentT => A }
def AgentT-inv (A : Type) (T : EventT) : A = getAgentT (setAgentT A T)
  => idp


public open struct Event (T : EventT) : Type 1
  | agent : T.AgentT

def getAgent (T : EventT) (e : Event T) : T.AgentT => e.agent


def Quantifier (A : Type) => (A -> Type 2) -> Type 3

def mkConstQ {A : Type} (x : A) : Quantifier A
  => \f => f x


def Verb (T : EventT) => ↑ Quantifier (Event T)

def mkVerb {T : EventT} (p : Event T -> Type) : Verb T
  => \f => Sig (e : Event T) ** (Sig (p e) ** (f e))

def VP (T : EventT) => Verb T


def BNP (A : Type) => Quantifier A

def GNP (setT : Type -> EventT -> EventT) (A : Type)
  => Pi {T : EventT} -> VP (setT A T) -> VP (setT A T)

def NP (A : Type) => ↑ GNP setAgentT A


def Theta (setT : Type -> EventT -> EventT)
  => Pi {A : Type} -> BNP A -> GNP setT A

def mkTheta
  (getT : EventT -> Type)
  (get : Pi (T : EventT) -> Event T -> getT T)
  (setT : Type -> EventT -> EventT)
  (T-inv : Pi (A : Type) (T : EventT) -> A ↑ = getT (setT A T))
  : Theta setT
  -- A : Type
  -- ↑ q : (↑ A -> Type 3) -> Type 4
  -- x : ↑ A
  -- p f : (setT A T -> Type) -> Type
  -- e : setT A T
  => \{A} => \q => \{T} => \p f => ↑ q (\x => p (\e =>
    Sig (get (setT A T) e ↑ ↑ = ↑ ↑ coe (↑ T-inv A T) x) ** (f e)))

def agentDef : Theta setAgentT
  => \{A} => mkTheta getAgentT getAgent setAgentT AgentT-inv {A}


def mkConstNP {A : Type} (x : A) : NP A
  => \{T} p => \f => p (\e => Sig (e.agent = x) ** (f e))


-- def Sentence => Type

def mkSentence {T : EventT} (p : ↑ Quantifier (Event T)) => p (\x => Unit)
